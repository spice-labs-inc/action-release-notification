name: "Spice Labs Slack Notifications"
description: "Send standardized release, deployment, and staging notifications to Slack with GitHub→Slack username mapping"
author: "Spice Labs Inc"

inputs:
  # Required
  type:
    description: "Notification type: release, deployment-success, deployment-failure, staging"
    required: true
  slack-bot-token:
    description: "Slack bot token (xoxb-...)"
    required: true
  channel:
    description: "Slack channel ID or name (e.g. #releases or C1234567890)"
    required: true
    default: "#release-notifications"
  channel-id:
    description: "Slack channel ID for reactions (use output from release notification)"
    required: false

  # GitHub→Slack username mapping
  username-mapping:
    description: 'JSON object mapping GitHub usernames to Slack user IDs {"github_user": "U1234567890"}'
    required: false

  # Release notification inputs (auto-generated by default)
  release-tag:
    description: "Release tag (e.g. v1.2.3) - optional, will use latest release if not provided"
    required: false
  github-token:
    description: "GitHub token for API access - required for auto-generation"
    required: false
  show-progress:
    description: "Add hourglass reaction to release post to indicate in-progress deployment"
    required: false
    default: "true"

  # Deployment notification inputs
  workflow-name:
    description: "Name of the workflow/deployment - required for deployment types"
    required: false
  workflow-url:
    description: "Link to the workflow run - auto-generated if not provided"
    required: false
  environment:
    description: "Deployment environment (e.g. production, staging) - required for deployment types"
    required: false
  thread-ts:
    description: "Timestamp of message to reply to (for threading deployment updates to release messages)"
    required: false

  # Staging notification inputs
  commit-message:
    description: "Commit message for staging deployments"
    required: false
  staging-url:
    description: "URL to the staging environment"
    required: false

  # Common optional inputs
  actor:
    description: "GitHub username who triggered the action"
    required: false
    default: ${{ github.actor }}
  repository:
    description: "Repository name"
    required: false
    default: ${{ github.repository }}
  branch:
    description: "Branch name"
    required: false
    default: ${{ github.ref_name }}
  commit-sha:
    description: "Commit SHA (long version recommended)"
    required: false

outputs:
  timestamp:
    description: "Timestamp of the sent message (for threading replies)"
  channel_id:
    description: "Channel ID of the sent message (for reactions)"

runs:
  using: "node24"
  main: "dist/notify.js"

branding:
  icon: "message-square"
  color: "blue"
